<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deezster Live</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. DAS BOPSTER-DESIGN (CSS) --- */
        :root {
            --primary: #23a6d5;
            --secondary: #e73c7e;
            --text-color: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }

        /* Animierter Hintergrund wie bei Bopster */
        body {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center; /* Zentriert den Inhalt vertikal */
            padding: 20px;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Der Glass-Container (die "Karte") */
        .app-container {
            width: 100%;
            max-width: 500px;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--glass-shadow);
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: height 0.3s ease;
        }

        /* Glanzeffekt oben */
        .app-container::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
        }

        h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 5px; text-shadow: 0 0 10px rgba(0,0,0,0.2); }
        h1 span { color: #fff; text-shadow: 0 0 15px var(--primary); }
        p.subtitle { opacity: 0.8; margin-bottom: 25px; font-size: 0.9rem; }

        /* Eingabefelder im Glass-Look */
        input {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 1.1rem;
            margin-bottom: 15px;
            outline: none;
            transition: all 0.2s;
            text-align: center;
        }
        input:focus { background: rgba(0, 0, 0, 0.4); border-color: white; }
        input::placeholder { color: rgba(255, 255, 255, 0.6); }

        /* Buttons im Bopster-Stil */
        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 10px;
        }
        .btn-primary {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn-primary:hover { background: rgba(255, 255, 255, 0.4); transform: translateY(-2px); }
        .btn-secondary { background: rgba(0, 0, 0, 0.3); color: white; }
        .btn-icon { width: 50px; padding: 0; border-radius: 50%; height: 50px; font-size: 1.2rem; display: inline-flex; }

        /* Playlist Liste */
        #playlist-list {
            max-height: 300px; overflow-y: auto; text-align: left; margin-top: 10px;
            scrollbar-width: none; /* Firefox */
        }
        #playlist-list::-webkit-scrollbar { display: none; /* Chrome */ }

        .playlist-item {
            display: flex; align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px; margin-bottom: 8px;
            border-radius: 12px; cursor: pointer;
            transition: background 0.2s; border: 1px solid transparent;
        }
        .playlist-item:hover { background: rgba(255, 255, 255, 0.25); border-color: rgba(255,255,255,0.3); }
        .playlist-item img { width: 45px; height: 45px; border-radius: 8px; margin-right: 12px; }
        .playlist-info h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .playlist-info span { font-size: 0.75rem; opacity: 0.7; }

        /* Vinyl Animation (Klassisch Hitster) */
        .vinyl-wrapper {
            margin: 20px auto;
            width: 220px; height: 220px;
            position: relative;
        }
        .vinyl {
            width: 100%; height: 100%;
            background: radial-gradient(#333, #111);
            border-radius: 50%;
            border: 4px solid #111;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
        }
        /* Rillen-Effekt */
        .vinyl::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%;
            background: repeating-radial-gradient(#111 0, #111 2px, #222 3px, #222 4px);
            opacity: 0.6;
        }
        .vinyl-label {
            width: 80px; height: 80px;
            background: var(--primary); /* Label Farbe */
            border-radius: 50%;
            z-index: 2;
            border: 2px solid white;
            background-size: cover;
            background-position: center;
        }
        .spinning { animation: spin 4s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Ergebnis Karte */
        .result-card {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            margin-top: 15px;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .year-big { font-size: 3.5rem; font-weight: 800; margin: 10px 0; display: block; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .cover-large { width: 150px; height: 150px; border-radius: 12px; margin: 10px auto; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: block; }

        /* Utility */
        .hidden { display: none !important; }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1); border-top: 4px solid #fff;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        .controls { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <h1>Deez<span>ster</span></h1>
            <p class="subtitle">Timeline Music Quiz</p>
        </header>

        <div id="start-screen">
            <div style="font-size: 4rem; margin-bottom: 20px;">üéµ</div>

            <input type="text" id="search-input" placeholder="Suche (z.B. 80s, Rock, Disney)...">
            <button id="search-btn" class="btn btn-primary"><i class="fas fa-search"></i> Suchen</button>

            <div style="margin-top: 20px; text-align: left;">
                <p style="font-size: 0.8rem; text-transform: uppercase; color: rgba(255,255,255,0.6); margin-bottom: 10px; font-weight: bold;">Empfohlene Playlists</p>
                <div id="playlist-list">
                    </div>
            </div>
        </div>

        <div id="loader" class="hidden">
            <div class="spinner"></div>
            <p>Plattenkiste wird durchw√ºhlt...</p>
        </div>

        <div id="game-screen" class="hidden">
            <div class="vinyl-wrapper">
                <div class="vinyl" id="vinyl-disc">
                    <div class="vinyl-label" id="vinyl-label-img"></div>
                </div>
            </div>

            <div class="controls">
                <button id="play-btn" class="btn btn-primary btn-icon"><i class="fas fa-play"></i></button>
            </div>

            <p style="margin-bottom: 15px; font-size: 0.9rem;">H√∂r dir den Song an. Wann erschien er?</p>

            <input type="number" id="year-input" placeholder="Jahr (z.B. 1984)" inputmode="numeric">
            <button id="guess-btn" class="btn btn-primary">Raten</button>
            <button onclick="location.reload()" class="btn btn-secondary" style="margin-top: 10px; border:none; background: transparent; font-size: 0.8rem;">Abbrechen</button>
        </div>

        <div id="result-screen" class="hidden">
            <div id="result-content"></div>
            <button id="next-btn" class="btn btn-primary" style="margin-top: 20px;">N√§chster Song <i class="fas fa-arrow-right"></i></button>
            <button onclick="location.reload()" class="btn btn-secondary" style="margin-top: 10px;">Playlist wechseln</button>
        </div>

        <audio id="audio-player"></audio>
    </div>

    <script>
        /* --- 2. DIE LOGIK (JAVASCRIPT - Deezer JSONP) --- */

        // Empfohlene Playlists (IDs von Deezer)
        const DEFAULT_PLAYLISTS = [
            { id: '3155776842', title: '100% Hits', img: 'https://e-cdns-images.dzcdn.net/images/playlist/89f6dfc009b0b43d2c0024440f340864/250x250-000000-80-0-0.jpg', count: 100 },
            { id: '1363560485', title: 'Best of 80s', img: 'https://e-cdns-images.dzcdn.net/images/playlist/73252538cb1235b2210a693c061d4b68/250x250-000000-80-0-0.jpg', count: 50 },
            { id: '1292055625', title: 'Best of 90s', img: 'https://e-cdns-images.dzcdn.net/images/playlist/4492476579b441f77d33b49e17b2f673/250x250-000000-80-0-0.jpg', count: 60 },
            { id: '1282495565', title: 'Best of 2000s', img: 'https://e-cdns-images.dzcdn.net/images/playlist/6959146dfa5390c9b0e27c7f3b890a2c/250x250-000000-80-0-0.jpg', count: 70 }
        ];

        let currentPlaylistId = null;
        let currentTrack = null;
        let isPlaying = false;

        // Elemente
        const screens = {
            start: document.getElementById('start-screen'),
            loader: document.getElementById('loader'),
            game: document.getElementById('game-screen'),
            result: document.getElementById('result-screen')
        };
        const els = {
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('search-btn'),
            list: document.getElementById('playlist-list'),
            audio: document.getElementById('audio-player'),
            vinyl: document.getElementById('vinyl-disc'),
            vinylLabel: document.getElementById('vinyl-label-img'),
            playBtn: document.getElementById('play-btn'),
            guessBtn: document.getElementById('guess-btn'),
            yearInput: document.getElementById('year-input'),
            resultContent: document.getElementById('result-content'),
            nextBtn: document.getElementById('next-btn')
        };

        // Init
        renderPlaylists(DEFAULT_PLAYLISTS);

        // Events
        els.searchBtn.addEventListener('click', searchPlaylists);
        els.searchInput.addEventListener('keypress', (e) => e.key === 'Enter' && searchPlaylists());
        els.playBtn.addEventListener('click', toggleAudio);
        els.guessBtn.addEventListener('click', checkGuess);
        els.nextBtn.addEventListener('click', loadNextSong);

        // --- FUNKTIONEN ---

        // 1. JSONP Helper (Der magische Schl√ºssel f√ºr GitHub Pages)
        function fetchDeezer(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                const cbName = 'dz_' + Math.round(Math.random() * 100000);

                window[cbName] = (data) => {
                    delete window[cbName];
                    document.body.removeChild(script);
                    resolve(data);
                };

                const sep = url.includes('?') ? '&' : '?';
                script.src = url + sep + 'output=jsonp&callback=' + cbName;
                script.onerror = () => {
                    delete window[cbName];
                    document.body.removeChild(script);
                    reject(new Error("Deezer API Fehler"));
                };
                document.body.appendChild(script);
            });
        }

        // 2. Playlists suchen
        async function searchPlaylists() {
            const query = els.searchInput.value.trim();
            if(!query) return;

            els.list.innerHTML = '<p style="color:white; opacity:0.7;">Suche...</p>';

            try {
                const data = await fetchDeezer(`https://api.deezer.com/search/playlist?q=${encodeURIComponent(query)}`);
                if(data.data) {
                    const results = data.data.map(p => ({
                        id: p.id, title: p.title, img: p.picture_medium, count: p.nb_tracks
                    }));
                    renderPlaylists(results);
                }
            } catch(e) {
                els.list.innerHTML = '<p>Fehler bei der Suche.</p>';
            }
        }

        function renderPlaylists(items) {
            els.list.innerHTML = '';
            items.forEach(p => {
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.innerHTML = `
                    <img src="${p.img}" alt="">
                    <div class="playlist-info">
                        <h4>${p.title}</h4>
                        <span>${p.count} Songs</span>
                    </div>
                `;
                div.onclick = () => startGame(p.id);
                els.list.appendChild(div);
            });
        }

        // 3. Spiel starten
        function startGame(id) {
            currentPlaylistId = id;
            loadNextSong();
        }

        async function loadNextSong() {
            showScreen('loader');
            els.yearInput.value = '';
            isPlaying = false;
            updatePlayIcon();

            try {
                // Tracklist holen
                const tracksData = await fetchDeezer(`https://api.deezer.com/playlist/${currentPlaylistId}/tracks?limit=100`);
                if(!tracksData.data || tracksData.data.length === 0) throw new Error("Keine Songs");

                // Zuf√§lligen g√ºltigen Song suchen (einer mit Preview & Album)
                let valid = false;
                let track;
                let attempts = 0;

                while(!valid && attempts < 20) {
                    track = tracksData.data[Math.floor(Math.random() * tracksData.data.length)];
                    if(track.preview && track.album && track.album.id) valid = true;
                    attempts++;
                }
                if(!valid) throw new Error("Keine abspielbaren Songs gefunden.");

                // Album Details holen (f√ºr das genaue Jahr)
                const albumData = await fetchDeezer(`https://api.deezer.com/album/${track.album.id}`);

                currentTrack = {
                    title: track.title,
                    artist: track.artist.name,
                    cover: track.album.cover_xl, // Hohe Aufl√∂sung f√ºr Ergebnis
                    preview: track.preview,
                    year: parseInt(albumData.release_date.split('-')[0])
                };

                // Player setup
                els.audio.src = currentTrack.preview;
                els.audio.volume = 0.5;

                // Vinyl Label setzen (kleines Bild)
                els.vinylLabel.style.backgroundImage = `url(${track.album.cover_small})`;

                showScreen('game');
                toggleAudio(); // Autoplay

            } catch(e) {
                alert("Fehler: " + e.message);
                showScreen('start');
            }
        }

        // 4. Audio Steuerung
        function toggleAudio() {
            if(isPlaying) {
                els.audio.pause();
                els.vinyl.classList.remove('spinning');
            } else {
                els.audio.play().catch(e => console.log("Autoplay blockiert"));
                els.vinyl.classList.add('spinning');
            }
            isPlaying = !isPlaying;
            updatePlayIcon();
        }

        function updatePlayIcon() {
            els.playBtn.innerHTML = isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
        }

        // 5. Auswertung
        function checkGuess() {
            const userYear = parseInt(els.yearInput.value);
            if(!userYear) return;

            if(isPlaying) toggleAudio(); // Stop Music

            const diff = Math.abs(currentTrack.year - userYear);
            let color = '#e74c3c'; // Rot
            let msg = 'Leider falsch';

            if(diff === 0) { color = '#2ecc71'; msg = 'PERFEKT!'; } // Gr√ºn
            else if(diff <= 2) { color = '#f1c40f'; msg = 'Knapp daneben!'; } // Gelb

            els.resultContent.innerHTML = `
                <div class="result-card">
                    <h2 style="color:${color}">${msg}</h2>
                    <img src="${currentTrack.cover}" class="cover-large">
                    <h3>${currentTrack.title}</h3>
                    <p style="opacity:0.8">${currentTrack.artist}</p>
                    <span class="year-big" style="color:${color}">${currentTrack.year}</span>
                    <p>Dein Tipp: ${userYear} <span style="font-size:0.8rem">(${diff === 0 ? 'Volltreffer' : diff + ' Jahre daneben'})</span></p>
                </div>
            `;

            showScreen('result');
        }

        function showScreen(name) {
            Object.values(screens).forEach(s => s.classList.add('hidden'));
            screens[name].classList.remove('hidden');
        }

    </script>
</body>
</html>
